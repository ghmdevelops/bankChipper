<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Minha Carteira Crypto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2a2a2a">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            background: #121212;
            color: #e1e1e1;
            font-family: "Segoe UI", sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh
        }

        .carteira {
            flex: 1;
            max-width: 460px;
            width: 100%;
            margin: 0 auto;
            background: #1e1e1e;
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6)
        }

        .header {
            padding: 1.5rem;
            background: linear-gradient(135deg, #333, #222)
        }

        .header h1 {
            color: #fff;
            font-size: 1.5rem;
            margin-bottom: .6rem
        }

        .saldo-total {
            display: flex;
            justify-content: space-between;
            align-items: flex-end
        }

        .valor-container {
            display: flex;
            align-items: center
        }

        .toggle-saldo {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            margin-left: .5rem;
            cursor: pointer
        }

        .saldo-total .valor {
            font-size: 2rem;
            font-weight: 700;
            color: #fff
        }

        .saldo-total .rendimento.up {
            color: #4caf50
        }

        .saldo-total .rendimento.down {
            color: #f44336
        }

        #btnInstall {
            display: inline-block;
            width: calc(50% - 1rem);
            margin: .5rem .5rem 0 0;
            padding: .8rem;
            background: #4caf50;
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4)
        }

        #btnInstall:hover {
            background: #43a047
        }

        .totais-toggle {
            margin-top: 1rem;
            padding: 0 1.5rem;
            font-size: 1rem;
            color: #aaa;
            cursor: pointer;
            display: flex;
            justify-content: space-between
        }

        .totais-toggle .arrow {
            transition: transform .2s
        }

        .totais-toggle.collapsed .arrow {
            transform: rotate(-90deg)
        }

        .totais-dia {
            display: none;
            padding: 1rem 1.5rem;
            background: #2a2a2a;
            font-size: 1rem;
            justify-content: space-between
        }

        .totais-dia.show {
            display: flex
        }

        .totais-dia .ganho {
            color: #4caf50
        }

        .totais-dia .perda {
            color: #f44336
        }

        .lista-coins {
            flex: 1;
            overflow-y: auto;
            background: #1e1e1e
        }

        .coin {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #333;
            position: relative
        }

        .coin:last-child {
            border-bottom: none
        }

        .coin.hidden .valor-atual,
        .coin.hidden .var24h,
        .coin.hidden .coin-quant {
            color: transparent !important
        }

        .coin-info {
            display: flex;
            align-items: center
        }

        .coin-img-wrapper {
            position: relative;
            display: inline-block;
            margin-right: 1rem
        }

        .coin-img-wrapper img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #333;
            padding: 4px
        }

        .coin-img-wrapper .coin-badge {
            position: absolute;
            top: 0;
            right: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid #1e1e1e
        }

        .coin-badge.badge-up {
            background: #4caf50
        }

        .coin-badge.badge-down {
            background: #f44336
        }

        .coin-nome {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff
        }

        .coin-quant {
            font-size: .9rem;
            color: #bbb
        }

        .coin-valores {
            text-align: right;
            display: flex;
            align-items: center
        }

        .valor-atual {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin-right: .5rem
        }

        .var24h.up {
            color: #4caf50
        }

        .var24h.down {
            color: #f44336
        }

        .toggle-coin {
            background: none;
            border: none;
            color: #888;
            font-size: 1rem;
            cursor: pointer
        }

        .nav-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 460px;
            left: 50%;
            transform: translateX(-50%);
            height: 64px;
            background: linear-gradient(135deg, #242424, #1f1f1f);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            box-shadow: 0-4px 12px rgba(0, 0, 0, 0.6);
            z-index: 100
        }

        .nav-item {
            background: none;
            border: none;
            color: #888;
            font-size: 1.4rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            padding: .5rem
        }

        .nav-item.active,
        .nav-item:hover {
            color: #d16201
        }

        .nav-item.active::after {
            content: "";
            position: absolute;
            top: 6px;
            width: 6px;
            height: 6px;
            background: #4caf50;
            border-radius: 50%
        }

        @media(max-width:400px) {
            .header {
                padding: 1rem
            }

            #btnInstall {
                width: calc(100% - 3rem);
                margin: .8rem auto
            }

            .totais-toggle {
                padding: 0 1rem;
                font-size: .95rem
            }

            .totais-dia {
                padding: .8rem 1rem;
                font-size: .95rem
            }

            .coin {
                padding: .8rem 1rem
            }

            .coin-img-wrapper img {
                width: 36px;
                height: 36px
            }

            .coin-nome {
                font-size: 1rem
            }

            .coin-quant,
            .var24h {
                font-size: .85rem
            }

            .valor-atual {
                font-size: 1rem
            }

            .saldo-total .valor {
                font-size: 1.8rem
            }

            .header h1 {
                font-size: 1.3rem
            }
        }

        .swal2-popup {
            background: #2a2a2a !important;
            color: #eee !important
        }

        .swal2-title {
            color: #fff !important
        }

        .swal2-html-container {
            color: #ccc !important
        }

        .swal2-input {
            background: #333 !important;
            color: #fff !important;
            border: 1px solid #555 !important
        }

        .swal2-confirm {
            background-color: #2196f3 !important
        }

        .swal2-cancel {
            background-color: #555 !important
        }
    </style>
</head>

<body>
    <div class="carteira">
        <div class="header">
            <h5>Ge****e Ba***s</h5>
            <h1>Minha Carteira</h1>
            <div class="saldo-total">
                <div>
                    <div>Saldo total</div>
                    <div class="rendimento up">↑ R$ 0,00</div>
                </div>
                <div class="valor-container">
                    <div class="valor">R$ 0,00</div>
                    <button class="toggle-saldo" id="toggleSaldo"><i class="bi bi-eye-fill"></i></button>
                </div>
            </div>
            <div style="display:flex;flex-wrap:wrap">
                <button id="btnInstall">Instalar App</button>
            </div>
            <div class="totais-toggle collapsed" id="toggleTotais">
                <span>Totais do dia</span><span class="arrow">▶</span>
            </div>
            <div class="totais-dia" id="painelTotais">
                <div class="ganho">Ganho: R$ 0,00</div>
                <div class="perda">Perda: R$ 0,00</div>
            </div>
        </div>
        <div class="lista-coins" id="listaCoins"></div>
    </div>
    <div class="nav-bar">
        <button class="nav-item"><i class="bi bi-house-fill"></i></button>
        <button class="nav-item"><i class="bi bi-wallet-fill"></i></button>
        <button class="nav-item" id="btnTransfer"><i class="bi bi-arrow-up-right-circle"></i></button>
        <button class="nav-item"><i class="bi bi-list"></i></button>
    </div>
    <script>
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(console.error);
        if ('Notification' in window) Notification.requestPermission();
        let lastTotal = '', saldoHidden = false, deferredPrompt;
        const btnInstall = document.getElementById('btnInstall');
        btnInstall.style.display = 'none';
        window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; if (localStorage.getItem('appInstalled') !== 'true') btnInstall.style.display = 'inline-block' });
        btnInstall.addEventListener('click', async () => { if (!deferredPrompt) return; deferredPrompt.prompt(); const c = await deferredPrompt.userChoice; if (c.outcome === 'accepted') { localStorage.setItem('appInstalled', 'true'); btnInstall.style.display = 'none' } deferredPrompt = null });
        const investimentos = [
            { id: 'bitcoin', nome: 'Bitcoin', icon: 'https://assets.coingecko.com/coins/images/1/thumb/bitcoin.png', investido: 148000, threshold: 5 },
            { id: 'ethereum', nome: 'Ethereum', icon: 'https://assets.coingecko.com/coins/images/279/thumb/ethereum.png', investido: 38000, threshold: 4 },
            { id: 'solana', nome: 'Solana', icon: 'https://assets.coingecko.com/coins/images/4128/thumb/solana.png', investido: 20000, threshold: 6 },
            { id: 'monero', nome: 'Monero', icon: 'https://assets.coingecko.com/coins/images/69/thumb/monero_logo.png', investido: 24000, threshold: 5 },
            { id: 'cardano', nome: 'Cardano', icon: 'https://assets.coingecko.com/coins/images/975/thumb/cardano.png', investido: 3000, threshold: 3 }
        ];
        function formatBRL(v) { return v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) }
        async function carregarCarteira() {
            const ids = investimentos.map(c => c.id).join(',');
            const res = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=brl&ids=${ids}&per_page=20&page=1&sparkline=false&t=${Date.now()}`, { cache: 'no-store' });
            if (!res.ok) return console.error('API', res.status);
            const data = await res.json(), c = document.getElementById('listaCoins');
            c.innerHTML = '';
            let total = 0, ganhoDia = 0, perdaDia = 0;
            data.forEach(coin => {
                const inv = investimentos.find(x => x.id === coin.id);
                inv.current_price = coin.current_price;
                const pct = coin.price_change_percentage_24h, ganho = inv.investido * (pct / 100), atual = inv.investido + ganho;
                total += atual; ganho >= 0 ? ganhoDia += ganho : perdaDia += Math.abs(ganho);
                const passou = Math.abs(pct) >= inv.threshold;
                const badge = passou ? `<span class="coin-badge ${pct >= 0 ? 'badge-up' : 'badge-down'}"></span>` : '';
                const el = document.createElement('div');
                el.className = 'coin';
                el.innerHTML = `
          <div class="coin-info">
            <div class="coin-img-wrapper">
              <img src="${inv.icon}" alt="${inv.nome}">${badge}
            </div>
            <div>
              <div class="coin-nome">${inv.nome}</div>
              <div class="coin-quant">${(inv.investido / coin.current_price).toFixed(8)} ${coin.symbol.toUpperCase()}</div>
            </div>
          </div>
          <div class="coin-valores">
            <div class="valor-atual">${formatBRL(atual)}</div>
            <button class="toggle-coin"><i class="bi bi-eye-fill"></i></button>
            <div class="var24h ${pct >= 0 ? 'up' : 'down'}">
              ${pct >= 0 ? '↑' : '↓'} ${formatBRL(ganho)} (${pct.toFixed(2)}%)
            </div>
          </div>`;
                c.appendChild(el);
                if (passou && Notification.permission === 'granted') {
                    new Notification(`${inv.nome}: variação ${pct.toFixed(2)}%`, { body: `${inv.nome} ${pct >= 0 ? 'subiu' : 'caiu'} ${Math.abs(pct).toFixed(2)}% em 24h.`, icon: inv.icon });
                }
            });
            lastTotal = formatBRL(total);
            if (!saldoHidden) document.querySelector('.saldo-total .valor').textContent = lastTotal;
            const invTotal = investimentos.reduce((s, x) => s + x.investido, 0), rend = total - invTotal;
            const rEl = document.querySelector('.rendimento');
            rEl.textContent = `${rend >= 0 ? '↑ ' : '↓ '}${formatBRL(Math.abs(rend))}`;
            rEl.classList.toggle('up', rend >= 0); rEl.classList.toggle('down', rend < 0);
            document.querySelector('.totais-dia .ganho').textContent = `Ganho: ${formatBRL(ganhoDia)}`;
            document.querySelector('.totais-dia .perda').textContent = `Perda: ${formatBRL(perdaDia)}`;
        }
        document.getElementById('toggleSaldo').addEventListener('click', () => {
            saldoHidden = !saldoHidden;
            const e = document.querySelector('.saldo-total .valor');
            e.textContent = saldoHidden ? '••••••' : lastTotal;
            document.querySelector('#toggleSaldo i').className = saldoHidden ? 'bi bi-eye-slash-fill' : 'bi bi-eye-fill';
        });
        document.getElementById('toggleTotais').addEventListener('click', () => {
            document.getElementById('painelTotais').classList.toggle('show');
            document.getElementById('toggleTotais').classList.toggle('collapsed');
        });
        document.getElementById('listaCoins').addEventListener('click', e => {
            if (e.target.closest('.toggle-coin')) {
                const coin = e.target.closest('.coin');
                coin.classList.toggle('hidden');
                const ico = coin.querySelector('.toggle-coin i');
                ico.className = coin.classList.contains('hidden') ? 'bi bi-eye-slash-fill' : 'bi bi-eye-fill';
            }
        });
        document.getElementById('btnTransfer').addEventListener('click', async () => {
            const history = ['1BoatSLRHtKNngkdXEeobR76b53LETtpyT', '3FZbgi29cpjq2GjdwV8eyHuJJnkLtktZc5', '1HB5XMLmzFVj8ALj6mfBsbifRoD4miY36v'];
            const { value: address } = await Swal.fire({ title: 'Endereço de destino', html: `<input id="swal-address" list="history" class="swal2-input" placeholder="Endereço ou selecione"><datalist id="history">${history.map(a => `<option value="${a}">`).join('')}</datalist>`, focusConfirm: false, showCancelButton: true, confirmButtonText: 'Próximo', cancelButtonText: 'Cancelar', preConfirm: () => { const v = document.getElementById('swal-address').value; if (!v) throw 'Endereço obrigatório!'; if (!/^([13][a-km-zA-HJ-NP-Z1-9]{25,34})$/.test(v)) throw 'Formato inválido!'; return v }, didOpen: () => document.getElementById('swal-address').focus() });
            if (!address) return;
            const btc = investimentos.find(c => c.id === 'bitcoin');
            const { value: amount } = await Swal.fire({ title: 'Quantas moedas deseja transferir?', html: `<input id="swal-input-amount" class="swal2-input" type="number" placeholder="0.01" min="0.00000001" step="0.00000001"><div id="swal-equivalent" style="color:#ccc;font-size:.9rem;margin-top:-.5rem;">Equivalente: R$ 0,00</div>`, focusConfirm: false, showCancelButton: true, confirmButtonText: 'Transferir', cancelButtonText: 'Cancelar', preConfirm: () => { const v = parseFloat(document.getElementById('swal-input-amount').value); if (!v || isNaN(v) || v <= 0) throw 'Quantidade inválida'; if (v * btc.current_price > btc.investido) throw 'Saldo insuficiente'; return v }, didOpen: () => { const inp = document.getElementById('swal-input-amount'), eq = document.getElementById('swal-equivalent'); inp.addEventListener('input', () => { const v = parseFloat(inp.value) || 0; eq.textContent = `Equivalente: ${formatBRL(v * btc.current_price)}` }); inp.focus() } })
            if (!amount) return;
            await Swal.fire({ title: 'Autenticação Ledger', html: 'Aguardando confirmação no Ledger por <strong>30</strong> segundos.', allowOutsideClick: false, showConfirmButton: false, timer: 30000, timerProgressBar: true, didOpen: () => { Swal.showLoading(); const b = Swal.getHtmlContainer().querySelector('strong'); let t = 30; const iv = setInterval(() => b.textContent = --t, 1000); Swal.willClose(() => clearInterval(iv)) } });
            await new Promise(r => setTimeout(r, 50));
            let erro = null;
            try { await Promise.race([navigator.credentials.get({ publicKey: { challenge: new Uint8Array(32), timeout: 30000, userVerification: 'required' } }), new Promise((_, r) => setTimeout(() => r(new Error('timeout')), 30000))]) } catch (e) { erro = e }
            Swal.close();
            if (erro) { const isTimeout = erro.message === 'timeout'; return Swal.fire({ icon: 'error', title: 'Erro', text: isTimeout ? 'Tempo esgotado.' : 'Autenticação não realizada.', timer: 2000, showConfirmButton: false }) }
            const valorBRL = amount * btc.current_price;
            btc.investido = Math.max(0, btc.investido - valorBRL);
            carregarCarteira();
            Swal.fire({ icon: 'success', title: 'Transferência concluída', html: `<p><strong>Endereço:</strong> ${address}</p><p><strong>Quantidade:</strong> ${amount} BTC</p><p><strong>Valor:</strong> ${formatBRL(valorBRL)}</p>` });
        });
        carregarCarteira().catch(console.error);
        setInterval(() => carregarCarteira().catch(console.error), 60000);
    </script>
</body>

</html>